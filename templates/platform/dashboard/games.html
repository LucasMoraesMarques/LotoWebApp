<!--
=========================================================
* Soft UI Dashboard - v1.0.3
=========================================================

* Product Page: https://www.creative-tim.com/product/soft-ui-dashboard
* Copyright 2021 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)

* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->

{% extends 'platform/dashboard/base.html' %}
{% load static %}

{% block css %}

{% endblock %}

{% block content %}
<div class="messages d-none">
  {% if messages %}
  {% for message in messages %}
    <p>{{message}}</p>
  {% endfor %}
  {% endif %}
</div>
<div class="container-fluid py-4">
  <!--i class="fa fa-bars" id="menu"></i-->
  <div class="alert alert-success alert-dismissible fade show float-right" role="alert" style="display:none; position: fixed;top: 100px;z-index:1500;width:60%;color:#fff;" id="messages">
        <span class="alert-text">
        </span>
        <button type="button" class="btn-close" id="hide-message" aria-label="Close">
            <span aria-hidden="true">X</span>
        </button>
    </div>

  <div class="nav-wrapper position-relative end-0">
    <!-- Tabs Nav -->
    <ul class="nav nav-pills nav-fill p-1" role="tablist">
      <li class="nav-item">
        <a class="nav-link mb-0 px-0 py-1 active" data-bs-toggle="tab" href="#geradores-tab" data-bs-target="#geradores-tab"
           role="tab" aria-controls="preview" aria-selected="true">
          <i class="fas fa-tools"></i> Geradores
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link mb-0 px-0 py-1" data-bs-toggle="tab" href="#colecoes-tab" data-bs-target="#colecoes-tab" role="tab"
           aria-controls="code" aria-selected="false">
          <i class="fas fa-list-ol"></i> Coleções
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link mb-0 px-0 py-1" data-bs-toggle="tab" href="#resultados-tab" data-bs-target="#resultados-tab"
           role="tab" aria-controls="code" aria-selected="false">
          <i class="fas fa-tasks"></i> Conjuntos
        </a>
      </li>
    </ul>
    <!-- End Tabs Nav -->

    <!-- Content Section -->
    <div class="tab-content" id="nav-tabContent">
      <!-- Generators Section -->
      <div class="tab-pane fade show active" id="geradores-tab" role="tabpanel" aria-labelledby="nav-geradores-tab">
        <!-- Info Section -->
        <div class="row mt-4">
          <div class="col-lg-7 mb-lg-0 mb-4">
            <div class="card">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-lg-6">
                    <div class="d-flex flex-column h-100">
                      <h5 class="font-weight-bolder">Nossos Geradores</h5>
                      <p>
                        Oferecemos dois tipos de geradores de jogos randômicos:
                      <ul>
                        <li>Simples</li>
                        <li>Inteligente</li>
                      </ul>
                      Escolha com sabedoria!
                      </p>
                      <a class="text-body text-sm font-weight-bold mb-0 icon-move-right mt-auto" href="javascript:;">
                        Leia sobre
                        <i class="fas fa-arrow-right text-sm ms-1" aria-hidden="true"></i>
                      </a>
                    </div>
                  </div>
                  <div class="col-lg-5 ms-auto text-center mt-5 mt-lg-0">
                    <div class="border-radius-lg h-100">
                      <img src="{% static 'assets/img/shapes/waves-white.svg' %}"
                           class="position-absolute h-100 w-50 top-0 d-lg-block d-none" alt="waves">
                      <div class="position-relative d-flex align-items-center justify-content-center h-100">
                        <img class="w-100 position-relative z-index-2 pt-4"
                             src="{% static 'assets/img/gen-options.svg' %}" alt="Pessoa escolhendo entre opções">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-5">
            <div class="card h-100">
              <div class="overflow-hidden position-relative border-radius-lg h-100">
                <div class="card-body position-relative z-index-1 d-flex flex-column h-100 p-3">
                  <h5 class="font-weight-bolder">Loterias Disponíveis</h5>
                  <p class="text-body">Nossa plataforma suporta as seguintes modalidades da Loteria Federal.</p>
                  <div class="d-flex flex-row w-100 p-3">
                    {% for lottery in lotteries %}
                    <img src="{% static 'assets/img/loterias/logos/'|add:lottery.name|add:'.png' %}" alt="Logo da {{lottery.name|capfirst}}"
                         class="btn-tooltip mx-3" data-bs-toggle="tooltip" data-bs-placement="top"
                         title="{{ lottery.name|capfirst }}" data-container="body" data-animation="true"
                         style="width:50px; height:50px;">
                    {% endfor %}
                  </div>
                  <a class="text-body text-sm font-weight-bold mb-0 icon-move-right mt-auto" href="javascript:;">
                    Leia sobre
                    <i class="fas fa-arrow-right text-sm ms-1" aria-hidden="true"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- End Info Section -->

        <!-- Generator Section -->
        <div class="row mt-4">
          <div class="col-lg- mb-lg-0 mb-4">
            <div class="card z-index-2">
              <div class="card-body p-3">
                <form id="gerador-form">
                  {% csrf_token %}
                  <div class="row">
                    <div class="col-lg-7">
                      <div class="d-flex flex-column h-100">
                        <h5 class="font-weight-bolder">Geração de Jogos Randômicos</h5>
                        <p>Escolha o gerador, a loteria e seus respectivos parâmetros</p>
                        <h6 class="font-weight-bolder">Geradores</h6>
                        <div class="d-flex flex-row h-100" id="generators">
                          <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" name="generator" value="simple" required
                                   id="simple" onchange="handleGeneratorSelect(this)">
                            <label class="custom-control-label" for="simple">Simples</label>
                          </div>
                          <div class="form-check ms-5">
                            <input class="form-check-input" type="radio" name="generator" value="smart" id="smart"
                                   required onchange="handleGeneratorSelect(this)">
                            <label class="custom-control-label" for="smart">Inteligente</label>
                          </div>
                        </div>
                        <h6 class="font-weight-bolder">Modalidade</h6>
                        <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                          {% for lottery in lotteries %}
                          <input type="radio" class="btn-check" name="lottery_name" id="lottery-{{lottery.name}}"
                                 value="{{lottery.name}}"
                                 autocomplete="off" required
                                  onclick="handleLotteryParams('{{lottery.name}}')">
                          <label class="btn btn-outline-primary" for="lottery-{{lottery.name}}">{{lottery.name|capfirst}}</label>
                          {% endfor %}
                        </div>

                        <div class="form-group">
                          <label for="gameset-name" class="form-control-label"><h6 class="font-weight-bolder">Nome
                            do Jogo</h6></label>
                          <input class="form-control" type="text" name="gameset-name" value="" id="gameset-name" required>
                        </div>

                        <div class="form-group">
                          <label for="collection-gen-select" class="form-control-label"><h6 class="font-weight-bolder">
                            Coleção</h6></label>
                          <div class="input-group mb-3">
                            <select class="form-control custom-select" id="collection-gen-select" aria-describedby="add-collection"  style="height:150px;"
                                    name="collection" multiple required>
                              {% for collection in collectionsData.collections %}
                              <option value="{{collection.id}}" loto-name="{{collection.loto_name}}">{{collection.name|capfirst}}</option>
                              {% endfor %}
                            </select>

                          </div>
                          <button class="btn btn-outline-primary mb-0" type="button" id="add-collection" data-bs-toggle="modal" data-bs-target="#addCollectionModal">Adicionar
                              nova
                            </button>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-5 ms-auto text-center mt-5 mt-lg-0">
                      <div class="border-radius-lg h-100">
                        <div class="position-relative d-flex align-items-center justify-content-center h-100">
                          <img class="w-100 position-relative z-index-2 pt-4"
                               src="{% static 'assets/img/gen-options2.svg' %}"
                               alt="Pessoa habilitando botões do tipo switch">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                      <h6 class="font-weight-bolder">Escolha a quantia de números por jogo</h6>
                      <div class="d-flex flex-column h-100" id="check-nPlayed">
                        <div class="reset-placeholder">
                          <p>Escolha a loteria e depois o número de marcações</p>
                        </div>
                        <div class="numbers d-flex flex-row h-100">
                          </div>
                      </div>
                    </div>
                    <div class="row mt-3 justify-content-center" id="grid-fixed-removed">
                        <div class="col-md-6">
                        <h6 class="font-weight-bolder">Escolha os números a serem fixados</h6>
                        <div class="row row-cols-auto gx-2 justify-content-center align-items-center" id="grid-fixed">
                          <div class="reset-placeholder d-flex flex-column justify-content-center align-items-center" style="display:none;">
                            <p>Escolha uma modalidade para liberar essa funcionalidade</p>
                          <img src="{% static 'assets/img/check-fixed-info.svg' %}" style="width:60%" alt="">
                          </div>
                          <div class="numbers row row-cols-auto gx-2 justify-content-center align-items-center" >
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <h6 class="font-weight-bolder">Escolha os números a serem removidos</h6>
                        <div class="row row-cols-auto gx-2 justify-content-center align-items-center" id="grid-removed">
                          <div class="reset-placeholder d-flex flex-column justify-content-center align-items-center" style="display:none;">
                            <p>Além da loteria, escolha o número de marcações por jogos</p>
                          <img src="{% static 'assets/img/check-removed-info.svg' %}" style="width:60%" alt="">
                          </div>
                          <div class="numbers row row-cols-auto gx-2 justify-content-center align-items-center">
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row" id="smart-gen-options" style="display:none">
                      <div class="col-lg-6 ms-auto text-center mt-5 mt-lg-0">
                        <div class="border-radius-lg h-100">
                          <div class="position-relative d-flex align-items-center justify-content-center h-100">
                            <img class="w-100 position-relative z-index-2 pt-4"
                                 src="{% static 'assets/img/gen-options3.svg' %}"
                                 alt="Mulher posicionando botões do tipo slider">
                          </div>
                        </div>
                      </div>
                      <div class="col">
                        <div class="form-group">
                          <label for="nPrimes" class="form-control-label mt-2"><h6 class="font-weight-bolder">
                            Número de Primos</h6></label>
                          <input class="form-control d-inline" type="number" name="nPrimes" value="" id="nPrimes">
                          <label for="maxSeq" class="form-control-label mt-2"><h6
                              class="font-weight-bolder">Máxima Sequência</h6></label>
                          <input class="form-control d-inline" type="number" value="" name="maxSeq" id="maxSeq">
                          <label for="minSeq" class="form-control-label mt-2"><h6
                              class="font-weight-bolder">Mínima Sequência</h6></label>
                          <input class="form-control d-inline" type="number" value="" name="minSeq" id="minSeq">
                          <label for="maxGap" class="form-control-label mt-2"><h6
                              class="font-weight-bolder">Máximo Salto</h6></label>
                          <input class="form-control d-inline" type="number" value="" name="maxGap" id="maxGap">
                          <h6 class="font-weight-bolder mt-2">Par ou Ímpar</h6>
                          <div class="d-flex flex-row h-100">
                            <div class="form-check mb-3">
                              <input class="form-check-input" type="radio" name="parity" value="even" id="even">
                              <label class="custom-control-label" for="even">Par</label>
                            </div>
                            <div class="form-check ms-5">
                              <input class="form-check-input" type="radio" name="parity" value="odd" id="odd">
                              <label class="custom-control-label" for="odd">Ímpar</label>
                            </div>
                            <div class="form-check ms-5">
                              <input class="form-check-input" type="radio" name="parity" value="odd" id="neutral">
                              <label class="custom-control-label" for="odd">Neutro</label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row justify-content-center flex-row align-items-center" id="nJogos-input-div" style="display:none">
                    <input type='hidden' name='calcCombs' value='False'>
                    <div class="col form-group my-0">
                      <label for="nJogos-input" class="form-control-label mt-2"><h6 class="font-weight-bolder">
                        Número de Jogos</h6></label>
                      <p id="nCombs-span"></p>
                      <input type="hidden" id="nCombs">
                      <input class="form-control d-inline" type="number" name="nJogos" value="" id="nJogos-input">
                    </div>
                    <div class="col-lg-3 ms-auto text-center mt-5 mt-lg-0">
                      <div class="border-radius-lg h-100">
                        <div class="position-relative d-flex align-items-center justify-content-center h-100">
                          <img class="w-100 position-relative z-index-2 pt-4"
                               src="{% static 'assets/img/nJogos-input.svg' %}"
                               alt="Pessoa usando uma calculadora">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-row justify-content-between align-items-center">
                     <div id="actions-buttons" class="flex-fill">
                    <input type="button" class="btn btn-primary mt-2 disabled" id="calc-combs-btn"
                         value="Calcular Combinações" onclick="calcNumberOfCombinations()">
                  <input type="button" class="btn btn-primary mt-2" id="submit-generator" value="Gerar jogos" style="display:none">
                  <input type="button" class="btn btn-primary mt-2 float-end" id="reset-generator-form" value="Resetar Formulário"
                         style="display:none">
                  <input type="button" class="btn btn-primary mt-2 mx-2" id="see-games-set" style="display:none"
                         value="Ver Jogos" data-bs-toggle="modal" data-bs-target="#exampleModal">
                  </div>
                    <div id="counters" style="display:none">
                      <span class="btn pe-none btn-outline-success mb-2 games-checkbox" id="counter-fixed">0</span>
                      <span class="btn pe-none btn-outline-danger mb-2 games-checkbox" id="counter-removed">0</span>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- End Generator Section -->
      </div>
      <!-- End Generators Section -->

      <!-- Collections Section -->
      <div class="tab-pane fade" id="colecoes-tab" role="tabpanel" aria-labelledby="nav-colecoes-tab">
        <!-- Info Section -->
        <div class="row mt-4">
          <div class="col-lg-7 mb-lg-0 mb-4">
            <div class="card">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-lg-6">
                    <div class="d-flex flex-column h-100">
                      <h5 class="font-weight-bolder">Coleções de Jogos</h5>
                      <p>
                        Agrupe os seus conjuntos de jogos por coleções, seja por loterias, concursos ou bolões e
                        mantenha
                        tudo organizado
                      </p>
                      <a class="text-body text-sm font-weight-bold mb-0 icon-move-right mt-auto" href="javascript:;">
                        Leia sobre
                        <i class="fas fa-arrow-right text-sm ms-1" aria-hidden="true"></i>
                      </a>
                    </div>
                  </div>
                  <div class="col-lg-5 ms-auto text-center mt-5 mt-lg-0">
                    <div class="border-radius-lg h-100">
                      <img src="{% static 'assets/img/shapes/waves-white.svg' %}"
                           class="position-absolute h-100 w-50 top-0 d-lg-block d-none" alt="waves">
                      <div class="position-relative d-flex align-items-center justify-content-center h-100">
                        <img class="w-100 position-relative z-index-2 pt-4"
                             src="{% static 'assets/img/collection-add.svg' %}" alt="Arquivos com um ícone de adicionar">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-5">
            <div class="card h-100">
              <div class="card-body p-3">
                <h5 class="font-weight-bolder mb-2">Análise das Coleções</h5>
                <div class="row mb-2">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 font-weight-bold">Você possui</p>
                      <h5 class="font-weight-bolder mb-0">
                        {{collectionsData.totalCollections}} coleções
                      </h5>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                      <i class="ni ni-collection text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
                <div class="row mb-2">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 font-weight-bold">Que juntas somam </p>
                      <h5 class="font-weight-bolder mb-0">
                        {{collectionsData.totalGamesets}} conjuntos
                      </h5>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                      <i class="ni ni-single-copy-04 text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 font-weight-bold">E totalizam</p>
                      <h5 class="font-weight-bolder mb-0">
                        {{collectionsData.totalGames.sum}} jogos
                      </h5>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                      <i class="ni ni-tag text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- End Info Section -->

        <!-- Collections Table Section -->
        <div class="row my-4">
          <div class="col">
            <div class="card p-3 d-flex">
              <div class="row">
                <div class="col">
                  <h5 class="font-weight-bolder">Adicione Coleções</h5>
                  <span class="text-sm">Importe arquivos em formato csv ou xlsx</span>
                  <form action="{% url 'lottery:create-collection' %}" method="POST" enctype="multipart/form-data" id="collection-file-form">
                    {% csrf_token %}
                    <div class="form-group">
                      <div class="custom-file mb-3">
                        <input type="file" class="form-control" id="customFile" name="file">
                      </div>
                      <div class="input-group mb-3">
                        <input type="text" placeholder="Nome da coleção" class="form-control" name="name"/>
                        <button class="btn btn-outline-primary mb-0" type="submit" id="add-collection2">Adicionar nova
                        </button>
                      </div>
                    </div>
                  </form>
                  <p class="text-center align-middle">
                    <i class="fa fa-plus-square fs-3 "></i>
                  </p>
                  <p>Crie coleções vazias para usá-las ao gerar seus conjunto de jogos. Escolha o nome e a loteria para
                  criar uma nova coleção
                  </p>
                </div>
                <div class="col d-flex align-items-center justify-content-center flex-column">
                  <p class="text-center align-middle">
                    <i class="fa fa-info-circle fs-3 "></i>
                  </p>
                  <p>As coleções devem estar com os conjuntos de jogos separados em abas se for do tipo xlsx, ou em por
                    vírgulas se for csv. Veja os modelos abaixo:
                  <p class="text-center">
                    <a href=""><i class="fa fa-file-excel fs-2 mx-3"></i></a>
                    <a href=""><i class="fa fa-file-csv fs-2 mx-3"></i></a>
                  </p>
                  </p>
                  <button class="btn btn-outline-primary mb-0" type="button" id="add-collection3" data-bs-toggle="modal"
                          data-bs-target="#addCollectionModal">Criar
                    nova
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <div class="card">
              <div class="card-header pb-0 d-flex flex-row justify-content-between align-items-center">
                <div class="d-inline">
                  <h5 class="font-weight-bolder">Suas Coleções</h5>
                  <p class="text-sm">Clique em info para ver detalhes de cada conjunto e/ou jogo na coleção</p>
                </div>
                <form action="{% url 'lottery:games' %}" id="edit-collection" method="POST">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="">
                 </form>
                <div class="buttons">
                  <button type="button" class="btn btn-danger" id="delete-collections">DELETAR</button>
                </div>
              </div>
              <div class="card-body px-2 pt-0 pb-2">
                <div class="table-responsive p-0">

                  <table class="table align-items-center mb-0 display" id="collections-table">
                    <thead>
                    <tr>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder text-center">
                        <input type="checkbox" name="select-all" value="">
                      </th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Loteria</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder ps-2">Nome</th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder">Nº de
                        Conjuntos
                      </th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder">Nº de
                        Jogos
                      </th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder">Info
                      </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for collection in collectionsData.collections %}
                    {% with 'assets/img/loterias/logos/'|add:collection.lottery.name|add:'.png' as lotteryLogo %}
                    <tr>
                      <td>
                        <input type="hidden" name="collections" value="{{collection.id}}">
                      </td>
                      <td>
                        <div class="d-flex px-2 py-1 align-middle">
                          <img src="{% static lotteryLogo %}" alt="Logo da {{collection.lottery.name}}"
                               class="btn-tooltip text-info text-gradient" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Logo da {{collection.lottery.name}}" data-container="body" data-animation="true">
                        </div>
                        <p hidden>{{collection.lottery.name}}</p>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">{{collection.name|capfirst}}</p>
                      </td>
                      <td class="align-middle text-center text-sm">
                        <span class="badge badge-sm bg-gradient-primary">{{collection.numberOfGamesets|capfirst}}</span>
                      </td>
                      <td class="align-middle text-center">
                        <span class="badge badge-sm bg-gradient-primary">{{collection.numberOfGames|capfirst}}</span>
                      </td>
                      <td class="align-middle text-center">
                        <a href="{% url 'lottery:collection-detail' collection.id %}">
                          <span class="btn-inner--icon"><i class="fa fa-info-circle" style="font-size:20px"></i></span>
                        </a>
                      </td>
                    </tr>
                    {% endwith %}
                    {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
            <div class="col-lg-3 col-md-6">
            <div class="card">
              <div class="card-header pb-0">
                <h5 class="font-weight-bolder">Histórico</h5>
                <p class="text-sm">
                  Últimas coleções criadas
                </p>
              </div>
              <div class="card-body p-3">
                {% for collection in collectionsData.lastCollections %}
                {% with 'assets/img/loterias/logos/'|add:collection.lottery.name|add:'.png' as lotteryLogo %}
                <div class="timeline timeline-one-side">
                  <div class="timeline-block mb-3">
                  <span class="timeline-step">
                    <div class="d-flex px-2 py-1">
                          <img src="{% static lotteryLogo %}" alt="Logo da {{collection.lottery.name}}"
                               class="btn-tooltip text-info text-gradient" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Logo da {{collection.lottery.name}}" data-container="body" data-animation="true">
                        </div>
                        <p hidden>{{collection.lottery.name}}</p>
                  </span>
                    <a href="{% url 'lottery:collection-detail' collection.id %}" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Ver detalhes" data-container="body" data-animation="true">
                          <div class="timeline-content">
                      <h6 class="text-dark text-sm font-weight-bold mb-0"> {{collection.name|capfirst}}</h6>
                      <p class="text-secondary font-weight-bold text-xs mt-1 mb-0">{{collection.createdAt|date:"d M Y"}}</p>
                          </div>
                    </a>

                  </div>
                </div>

                {% endwith %}
                {% endfor %}

              </div>
            </div>
            </div>
        </div>


        <!-- End Collections Table Section -->
      </div>
      <!-- End Collections Section -->

      <!-- Results Section-->
      <div class="tab-pane fade" id="resultados-tab" role="tabpanel" aria-labelledby="nav-resultados-tab">
         <!-- Info Section -->
        <div class="row mt-4">
          <div class="col-lg-7 mb-lg-0 mb-4">
            <div class="card">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-lg-6">
                    <div class="d-flex flex-column h-100">
                      <h5 class="font-weight-bolder">Coleções de Jogos</h5>
                      <p>
                        Agrupe os seus conjuntos de jogos por coleções, seja por loterias, concursos ou bolões e
                        mantenha
                        tudo organizado
                      </p>
                      <a class="text-body text-sm font-weight-bold mb-0 icon-move-right mt-auto" href="javascript:;">
                        Leia sobre
                        <i class="fas fa-arrow-right text-sm ms-1" aria-hidden="true"></i>
                      </a>
                    </div>
                  </div>
                  <div class="col-lg-5 ms-auto text-center mt-5 mt-lg-0">
                    <div class="border-radius-lg h-100">
                      <img src="{% static 'assets/img/shapes/waves-white.svg' %}"
                           class="position-absolute h-100 w-50 top-0 d-lg-block d-none" alt="waves">
                      <div class="position-relative d-flex align-items-center justify-content-center h-100">
                        <img class="w-100 position-relative z-index-2 pt-4"
                             src="{% static 'assets/img/collection-add.svg' %}" alt="Arquivos com um ícone de adicionar">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-5">
            <div class="card h-100">
              <div class="card-body p-3">
                <h5 class="font-weight-bolder mb-2">Análise das Coleções</h5>
                <div class="row mb-2">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 font-weight-bold">Você possui</p>
                      <h5 class="font-weight-bolder mb-0">
                        {{collectionsData.totalCollections}} coleções
                      </h5>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                      <i class="ni ni-collection text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
                <div class="row mb-2">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 font-weight-bold">Que juntas somam </p>
                      <h5 class="font-weight-bolder mb-0">
                        {{collectionsData.totalGamesets}} conjuntos
                      </h5>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                      <i class="ni ni-single-copy-04 text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 font-weight-bold">E totalizam</p>
                      <h5 class="font-weight-bolder mb-0">
                        {{collectionsData.totalGames.sum}} jogos
                      </h5>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                      <i class="ni ni-tag text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- End Info Section -->

        <!-- Collections Table Section -->
          <div class="row my-4">
            <div class="col">
                 <div class="card p-3 d-flex">
              <div class="row">
                <div class="col">
                  <h5 class="font-weight-bolder">Adicione Conjuntos</h5>
                  <span class="text-sm">Importe arquivos em formato csv ou xlsx</span>
                  <form action="{% url 'lottery:create-collection' %}" method="POST" enctype="multipart/form-data" id="game-set-file-form">
                    {% csrf_token %}
                    <div class="form-group">
                      <div class="custom-file mb-3">
                        <input type="file" class="form-control" id="file" name="file">
                      </div>
                      <div class="input-group mb-3">
                        <input type="text" placeholder="Nome da coleção" class="form-control" name="name"/>
                        <button class="btn btn-outline-primary mb-0" type="submit" id="add-game-set">Adicionar nova
                        </button>
                      </div>
                    </div>
                  </form>
                  <p class="text-center align-middle">
                    <i class="fa fa-plus-square fs-3 "></i>
                  </p>
                  <p>Crie coleções vazias para usá-las ao gerar seus conjunto de jogos. Escolha o nome e a loteria para
                  criar uma nova coleção
                  </p>
                </div>
                <div class="col d-flex align-items-center justify-content-center flex-column">
                  <p class="text-center align-middle">
                    <i class="fa fa-info-circle fs-3 "></i>
                  </p>
                  <p>As coleções devem estar com os conjuntos de jogos separados em abas se for do tipo xlsx, ou em por
                    vírgulas se for csv. Veja os modelos abaixo:
                  <p class="text-center">
                    <a href=""><i class="fa fa-file-excel fs-2 mx-3"></i></a>
                    <a href=""><i class="fa fa-file-csv fs-2 mx-3"></i></a>
                  </p>
                  </p>
                    <button class="btn btn-outline-primary mb-0" type="button" id="add-game-set-btn" data-bs-toggle="modal" data-bs-target="#addCollectionModal">Criar
                              nova
                            </button>
                </div>
              </div>
            </div>
            </div>


        <!-- End Game Set Table Section -->
        </div>
                    <!-- Game Set Table Section -->
        <div class="row">
          <div class="col">
            <div class="card">
              <div class="card-header pb-0 d-flex flex-row justify-content-between align-items-center">
                <div class="d-inline">
                  <h5 class="font-weight-bolder">Conjunto de Jogos</h5>
                  <p class="text-sm">Clique em info para ver detalhes de cada conjunto e/ou jogo na coleção</p>
                  <p class="text-sm">
                    <i class="fa fa-search-plus text-success" aria-hidden="true"></i>
                    {{collectionsData.totalGamesets}} conjuntos encontrados
                  </p>

                <div class="buttons d-flex flex-row align-items-center mt-1 position-absolute">
                  <form action="{% url 'lottery:export-results-reports' %}" method="POST" id="export-results-form">
                    {% csrf_token %}
                    <div class="btn-group mx-3" role="group" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Exportar resultados" data-container="body" data-animation="true">
                    <a role="button" id="export-results" class="" data-bs-toggle="dropdown"
                       aria-expanded="false"><i class="fas fa-file-export fs-4 text-primary align-middle"></i> Exportar</a>
                    <ul class="dropdown-menu" aria-labelledby="export-results">
                      <li>
                        <a id="csv" role="button" class="fs-5 export-results-btn"><i class="fa fa-file-csv text-primary mx-2"></i>CSV</a>
                      </li>
                      <li>
                        <a id="excel" role="button" class="fs-5 export-results-btn"><i class="fa fa-file-excel text-primary mx-2"></i>Excel</a>
                      </li>
                    </ul>
                  </div>
                  </form>
                  <form action="{% url 'lottery:send-results-reports' 0 %}" method="POST" id="send-results-form">
                      {% csrf_token %}
                      <div class="btn-group mx-3" role="group" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Enviar resultados" data-container="body" data-animation="true">
                    <a role="button" id="send-results-options" class="text-center" data-bs-toggle="dropdown"
                       aria-expanded="false"><i class="fas fa-envelope fs-4 text-primary align-middle"></i> Enviar</a>
                    <ul class="dropdown-menu" aria-labelledby="send-results-options">
                      <li>
                        <a id="email" role="button" class="fs-5 send-results-btn"><i class="fa fa-envelope-open-text text-primary mx-2"></i>Email</a>
                      </li>
                      <li>
                        <a id="whatsapp" role="button" class="fs-5 send-results-btn" ><i class="fa fa-whatsapp text-primary mx-2"></i>WhatsApp</a>
                      </li>
                    </ul>
                      </div>
                  </form>
                      <div class="btn-group mx-3" role="group" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Editar status" data-container="body" data-animation="true">
                    <a role="button" id="edit-gameset-status-options" class="text-center" data-bs-toggle="dropdown"
                       aria-expanded="false"><i class="fas fa-check-circle fs-4 text-primary align-middle"></i> Status</a>
                    <ul class="dropdown-menu" aria-labelledby="edit-gameset-status-options">
                      <li>
                        <a id="activate-gamesets" role="button" class="fs-5 send-results-btn"><i class="fa fa-check text-primary mx-2"></i>Ativar</a>
                      </li>
                      <li>
                        <a id="deactivate-gamesets" role="button" class="fs-5 send-results-btn" ><i class="fa fa-times text-primary mx-2"></i>Desativar</a>
                      </li>
                    </ul>
                      </div>
                    <form action="{% url 'lottery:delete-results-reports' 0 %}" method="POST" id="action-results">
                      {% csrf_token %}
                       <div class="btn-group mx-3" role="group" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Deletar conjuntos" data-container="body" data-animation="true">
                      <a role="button" id="delete-gamesets" class="text-center"><i
                              class="fas fa-trash-alt fs-4 text-danger align-middle"></i>Deletar</a>
                         </div>

                      <input type="hidden" name="action" value="">
                    </form>
                </div>
                </div>
                <form action="{% url 'lottery:games' %}" id="modify-gameset" method="POST">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="">
                 </form>
              </div>
              <div class="card-body px-2 pt-0 pb-2">
                  <div class="table-responsive p-0">
                  <table class="table align-items-center mb-0 display responsive" id="gamesets-table">
                    <thead>
                    <tr>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 align-middle text-center">
                      <input type="checkbox" name="select-all" value="">
                      </th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Loteria</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Nome</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Coleção</th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Nº de
                        Jogos
                      </th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                        Ativo
                      </th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Info
                      </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for gameset in gamesetsData.gamesets %}
                    {% with 'assets/img/loterias/logos/'|add:gameset.lottery.name|add:'.png' as lotteryLogo %}
                    <tr>
                      <td class="align-middle text-center text-sm">
                        <input type="hidden" name="gamesets" value="{{gameset.id}}">
                      </td>
                      <td>
                        <div class="d-flex px-2 py-1">
                          <img src="{% static lotteryLogo %}" alt="Logo da {{gameset.lottery.name}}"
                               class="btn-tooltip text-info text-gradient" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Logo da {{gameset.lottery.name}}" data-container="body" data-animation="true">
                        </div>
                        <p hidden>{{gameset.lottery.name}}</p>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">{{gameset.name}}</p>
                      </td>
                      <td>
                        <ul class="text-xs font-weight-bold mb-0">
                        {% for collection in gameset.collections.all %}
                          <li>{{collection.name}}</li>
                        {% endfor %}
                        </ul>
                      </td>
                      <td class="align-middle text-center text-sm">
                        <span class="badge badge-sm bg-gradient-primary">{{gameset.numberOfGames}}</span>
                      </td>
                      <td class="align-middle text-center">
                        {% if gameset.isActive %}
                        <span class="badge badge-sm bg-gradient-success">SIM</span>
                        {% else %}
                        <span class="badge badge-sm bg-gradient-danger">NÃO</span>
                        {% endif %}
                      </td>
                      <td class="align-middle text-center">
                        <a href="{% url 'lottery:game-set-detail' gameset.id  %}">
                          <span class="btn-inner--icon"><i class="fa fa-info-circle" style="font-size:20px"></i></span>
                        </a>
                      </td>
                    </tr>
                    {% endwith %}
                    {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="card">
              <div class="card-header pb-0">
                <h5 class="font-weight-bolder">Histórico</h5>
                <p class="text-sm">
                  Últimos conjuntos criados
                </p>
              </div>
              <div class="card-body p-3">
                {% for gameset in gamesetsData.lastGamesets %}
                {% with 'assets/img/loterias/logos/'|add:gameset.lottery.name|add:'.png' as lotteryLogo %}

                <div class="timeline timeline-one-side">
                  <div class="timeline-block mb-3">
                  <span class="timeline-step">
                    <div class="d-flex px-2 py-1">
                          <img src="{% static lotteryLogo %}" alt="Logo da {{gameset.lottery.name}}"
                               class="btn-tooltip text-info text-gradient" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Logo da {{gameset.lottery.name}}" data-container="body" data-animation="true">
                        </div>
                        <p hidden>{{gameset.lottery.name}}</p>
                  </span>
                    <a href="{% url 'lottery:game-set-detail' gameset.id %}" data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               title="Ver detalhes" data-container="body" data-animation="true">
                          <div class="timeline-content">
                      <h6 class="text-dark text-sm font-weight-bold mb-0"> {{gameset.name|capfirst}}</h6>
                      <p class="text-secondary font-weight-bold text-xs mt-1 mb-0">{{gameset.createdAt|date:"d M Y"}}</p>
                    </div>
                        </a>
                  </div>
                </div>
                {% endwith %}
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End Results Section -->
    </div>
  </div>
  <!-- End Content Section -->
</div>

<div class="modal fade" id="exampleModal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" >
  <div class="modal-dialog modal-dialog-centered" role="document" style="max-width:80%; margin:auto;">
    <div class="modal-content" style="z-index:2000;width:100%; margin:auto;" id="modal-content-gameset">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Jogos Gerados</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">X</span>
        </button>
      </div>
      <div class="modal-body" style="overflow-x:scroll">
      </div>
      <div class="modal-footer d-flex flex-row">
        <div class="saving" style="display:none;">
        </div>
        <div class="buttons d-flex flex-row">
          <button type="button" class="btn bg-gradient-secondary mx-3" data-bs-dismiss="modal">Fechar</button>
          <button type="button" id="save-gameset" class="btn bg-gradient-primary">Salvar Jogo</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addCollectionModal" role="dialog" aria-labelledby="addCollectionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-md" role="document">
    <div class="modal-content" style="z-index:2000;">
      <div class="modal-header">
        <h5 class="modal-title" id="addCollectionModalLabel">Adicionar nova coleção</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">X</span>
        </button>
      </div>
      <form action="{% url 'lottery:create-collection' %}" method="POST" id="add-collection-form">
        {% csrf_token %}
      <div class="modal-body">
          {% for field in collectionForm %}
          {{field.label}}
          {{field}}
          {% endfor %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn bg-gradient-secondary" data-bs-dismiss="modal" id="close-add-collection">Fechar</button>
        <button type="submit" class="btn bg-gradient-primary">Adicionar</button>
      </div>
     </form>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script src="{% static 'js/games.js' %}"></script>
{% endblock %}



